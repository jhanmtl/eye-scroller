{"version":3,"sources":["priors.js","components/MyButton.js","components/SmallButton.js","text.js","App.js","serviceWorker.js","index.js"],"names":["priors","theme","createMuiTheme","palette","primary","main","secondary","MyButton","props","style","marginTop","variant","color","onClick","disabled","children","theme2","SmallButton","text","App","setCropProps","stream","videoHeight","getVideoTracks","getSettings","height","videoWidth","width","cen_x","cen_y","cropDim","destDim","sf","videoOriginX","videoOriginY","startWebcam","setState","inProgress","navigator","mediaDevices","getUserMedia","video","audio","then","videoRef","current","srcObject","display","inputCanvasRef","synchroPredict","cropToCanvas","inputCtx","drawImage","parsePredictions","predictions","confidence","reshape","offsets","splits","tf","gcx","gcy","gw","gh","recoverBboxes","cx","what","cxhat","cy","hhat","cyhat","w","h","x1","y1","x2","y2","bboxes","boxCrop","box","ctx","cenX","cenY","cropSize","Math","max","originX","originY","eyeDim","logRatioHistory","nowLeftRatio","nowRightRatio","leftRatioHistory","length","push","rightRatioHistory","percentDiff","ratioHistory","t0","performance","now","updateOutputCanvas","detectorModelInput","prepDetectorInput","detectorModel","predict","getBoxesAndScores","scoreLeft","scoreRight","boxLeft","boxRight","detectThreshold","visualize","leftCtx","rightCtx","leftLandmarks","predictLandmarks","leftCanvasRef","currentLeftRatio","drawLandmarks","rightLandmarks","rightCanvasRef","currentRightRatio","leftChange","rightChange","blinkThreshold","scrollDown","fillBlack","t1","logFps","window","requestAnimationFrame","scrollRef","scrollTo","state","scrollPos","newPos","min","scrollToTop","priorsTensor","undefined","landmarksModel","React","createRef","outputCanvasRef","outputCtx","leftTextRef","rightTextRef","fpsTextRef","landmarkCount","nmsSigma","this","priorSplits","loadedModel","getContext","console","log","x","y","strokeStyle","lineWidth","strokeRect","scoreA","scoreB","boxA","boxB","drawBox","innerText","toFixed","canvas","imgTensor","fromPixels","boxes","arraySync","nmsResult","nonMaxSuppressionWithScore","nmsIdx","selectedIndices","dataSync","nmsScores","selectedScores","elapsed","fps","round","inputCanvas","input","prepLandmarkInputSingle","prediction","fillStyle","fillRect","landmarks","i","beginPath","landmark","arc","PI","fill","startPt","endPt","moveTo","lineTo","stroke","topMarker","bottomMarker","centerX","centerY","abs","radius","leftMarker","rightMarker","paragraphs","key","className","elevation","id","autoPlay","ref","href","minimalThumbSize","maximalThumbSize","formatText","Component","Boolean","location","hostname","match","ReactDOM","render","StrictMode","document","getElementById","serviceWorker","ready","registration","unregister","catch","error","message"],"mappings":"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","file":"static/js/main.e1512a3f.chunk.js","sourcesContent":["export const priors =  [[0.08333333, 0.08333333, 0.14696938, 0.09797959],\n                       [0.08333333, 0.25      , 0.14696938, 0.09797959],\n                       [0.08333333, 0.41666667, 0.14696938, 0.09797959],\n                       [0.08333333, 0.58333333, 0.14696938, 0.09797959],\n                       [0.08333333, 0.75      , 0.14696938, 0.09797959],\n                       [0.08333333, 0.91666667, 0.14696938, 0.09797959],\n                       [0.25      , 0.08333333, 0.14696938, 0.09797959],\n                       [0.25      , 0.25      , 0.14696938, 0.09797959],\n                       [0.25      , 0.41666667, 0.14696938, 0.09797959],\n                       [0.25      , 0.58333333, 0.14696938, 0.09797959],\n                       [0.25      , 0.75      , 0.14696938, 0.09797959],\n                       [0.25      , 0.91666667, 0.14696938, 0.09797959],\n                       [0.41666667, 0.08333333, 0.14696938, 0.09797959],\n                       [0.41666667, 0.25      , 0.14696938, 0.09797959],\n                       [0.41666667, 0.41666667, 0.14696938, 0.09797959],\n                       [0.41666667, 0.58333333, 0.14696938, 0.09797959],\n                       [0.41666667, 0.75      , 0.14696938, 0.09797959],\n                       [0.41666667, 0.91666667, 0.14696938, 0.09797959],\n                       [0.58333333, 0.08333333, 0.14696938, 0.09797959],\n                       [0.58333333, 0.25      , 0.14696938, 0.09797959],\n                       [0.58333333, 0.41666667, 0.14696938, 0.09797959],\n                       [0.58333333, 0.58333333, 0.14696938, 0.09797959],\n                       [0.58333333, 0.75      , 0.14696938, 0.09797959],\n                       [0.58333333, 0.91666667, 0.14696938, 0.09797959],\n                       [0.75      , 0.08333333, 0.14696938, 0.09797959],\n                       [0.75      , 0.25      , 0.14696938, 0.09797959],\n                       [0.75      , 0.41666667, 0.14696938, 0.09797959],\n                       [0.75      , 0.58333333, 0.14696938, 0.09797959],\n                       [0.75      , 0.75      , 0.14696938, 0.09797959],\n                       [0.75      , 0.91666667, 0.14696938, 0.09797959],\n                       [0.91666667, 0.08333333, 0.14696938, 0.09797959],\n                       [0.91666667, 0.25      , 0.14696938, 0.09797959],\n                       [0.91666667, 0.41666667, 0.14696938, 0.09797959],\n                       [0.91666667, 0.58333333, 0.14696938, 0.09797959],\n                       [0.91666667, 0.75      , 0.14696938, 0.09797959],\n                       [0.91666667, 0.91666667, 0.14696938, 0.09797959]]","import React from 'react'\nimport {Button} from \"@material-ui/core\"\nimport { createMuiTheme } from '@material-ui/core/styles';\nimport { ThemeProvider } from '@material-ui/styles';\n\n\nconst theme = createMuiTheme({\n  palette: {\n    primary: {\n      main: \"#005582\",\n    },\n    secondary: {\n      main: '#11cb5f',\n    },\n  },\n});\n\n\nexport function MyButton(props){\n\n\n    return(\n            <div style={{marginTop:20}}>\n                <ThemeProvider theme={theme}>\n                        <Button  variant=\"contained\" color=\"primary\" onClick={props.onClick} disabled={props.disabled}>{props.children}</Button>\n                </ThemeProvider>\n            </div>\n    )\n\n}","import React from 'react'\nimport {Button} from \"@material-ui/core\"\nimport { createMuiTheme } from '@material-ui/core/styles';\nimport { ThemeProvider } from '@material-ui/styles';\n\n\nconst theme2 = createMuiTheme({\n  palette: {\n    primary: {\n      main: \"#005582\",\n    },\n    secondary: {\n      main: '#11cb5f',\n    },\n  },\n});\n\n\nexport function SmallButton(props){\n\n\n    return(\n        <div style={{marginTop:10}}>\n            <ThemeProvider theme={theme2}>\n                    <Button  variant=\"outlined\" color=\"primary\" onClick={props.onClick} disabled={props.disabled}>{props.children}</Button>\n            </ThemeProvider>\n        </div>\n    )\n\n}","export const text=\n    [\"This is a demonstration of combining Tensorflow and React to create an intelligent interface where the scrolling action of a document is controlled by the blinking movement of the user's eyes. \",\n        \"\\n\",\n    \"Inspired by the difficulty of simply turning a page and reading independently experienced by people suffering from whole-body paralysis.\",\n        \"\\n\",\n    \"blink to scroll down when model loaded\",\n\n    \"=====================================================\",\n    \"text below is a publicly available excerpt of the Martian from Andy Weir's website\",\n    \"\\n\",\n    \"Chapter 1\" ,\n\n    \"Six days into what should be the greatest two months of my life, and it’s turned into a nightmare.\" ,\n\n    \"I don’t even know who’ll read this. I guess someone will find it eventually. Maybe a hundred years from now.\" ,\n\n    \"For the record . . . I didn’t die on Sol 6. Certainly the rest of the crew thought I did, and I can’t blame them. Maybe there’ll be a day of national mourning for me, and my Wikipedia page will say, “Mark Watney is the only human being to have died on Mars.”\" ,\n\n    \"And it’ll be right, probably. ’Cause I’ll surely die here. Just not on Sol 6 when everyone thinks I did.\" ,\n\n    \"Let’s see . . . where do I begin?\" ,\n\n    \"The Ares Program. Mankind reaching out to Mars to send people to another planet for the very first time and expand the horizons of humanity blah, blah, blah. The Ares 1 crew did their thing and came back heroes. They got the parades and fame and love of the world.\" ,\n\n    \"Ares 2 did the same thing, in a different location on Mars. They got a firm handshake and a hot cup of coffee when they got home.\" ,\n\n    \"Ares 3. Well, that was my mission. Okay, not mine per se. Commander Lewis was in charge. I was just one of her crew. Actually, I was the very lowest ranked member of the crew. I would only be “in command” of the mission if I were the only remaining person.\" ,\n\n    \"What do you know? I’m in command.\" ,\n\n    \"I wonder if this log will be recovered before the rest of the crew die of old age. I presume they got back to Earth all right. Guys, if you’re reading this: It wasn’t your fault. You did what you had to do. In your position I would have done the same thing. I don’t blame you, and I’m glad you survived.\" ,\n\n    \"I guess I should explain how Mars missions work, for any layman who may be reading this. We got to Earth orbit the normal way, through an ordinary ship to Hermes. All the Ares missions use Hermes to get to and from Mars. It’s really big and cost a lot so NASA built only one.\" ,\n\n    \"Once we got to Hermes, four additional unmanned missions brought us fuel and supplies while we prepared for our trip. Once everything was a go, we set out for Mars. But not very fast. Gone are the days of heavy chemical fuel burns and trans-Mars injection orbits.\" ,\n\n    \"Hermes is powered by ion engines. They throw argon out the back of the ship really fast to get a tiny amount of acceleration. The thing is, it doesn’t take much reactant mass, so a little argon (and a nuclear reactor to power things) let us accelerate constantly the whole way there. You’d be amazed at how fast you can get going with a tiny acceleration over a long time.\" ,\n\n    \"I could regale you with tales of how we had great fun on the trip, but I won’t. I don’t feel like reliving it right now. Suffice it to say we got to Mars 124 days later without strangling each other.\" ,\n\n    \"From there, we took the MDV (Mars descent vehicle) to the surface. The MDV is basically a big can with some light thrusters and parachutes attached. Its sole purpose is to get six humans from Mars orbit to the surface without killing any of them.\" ,\n\n    \"And now we come to the real trick of Mars exploration: having all of our shit there in advance.\" ,\n\n    \"A total of fourteen unmanned missions deposited everything we would need for surface operations. They tried their best to land all the supply vessels in the same general area, and did a reasonably good job. Supplies aren’t nearly so fragile as humans and can hit the ground really hard. But they tend to bounce around a lot.\" ,\n\n    \"Naturally, they didn’t send us to Mars until they’d confirmed that all the supplies had made it to the surface and their containers weren’t breached. Start to finish, including supply missions, a Mars mission takes about three years. In fact, there were Ares 3 supplies en route to Mars while the Ares 2 crew were on their way home.\" ,\n\n    \"The most important piece of the advance supplies, of course, was the MAV. The Mars ascent vehicle. That was how we would get back to Hermes after surface operations were complete. The MAV was soft-landed (as opposed to the balloon bounce-fest the other supplies had). Of course, it was in constant communication with Houston, and if there had been any problems with it, we would have passed by Mars and gone home without ever landing.\" ,\n\n    \"The MAV is pretty cool. Turns out, through a neat set of chemical reactions with the Martian atmosphere, for every kilogram of hydrogen you bring to Mars, you can make thirteen kilograms of fuel. It’s a slow process, though. It takes twenty-four months to fill the tank. That’s why they sent it long before we got here.\" ,\n\n    \"You can imagine how disappointed I was when I discovered the MAV was gone.\" ,\n\n    \"It was a ridiculous sequence of events that led to me almost dying, and an even more ridiculous sequence that led to me surviving.\" ,\n\n    \"The mission is designed to handle sandstorm gusts up to 150 kph. So Houston got understandably nervous when we got whacked with 175 kph winds. We all got in our flight space suits and huddled in the middle of the Hab, just in case it lost pressure. But the Hab wasn’t the problem.\" ,\n\n    \"The MAV is a spaceship. It has a lot of delicate parts. It can put up with storms to a certain extent, but it can’t just get sandblasted forever. After an hour and a half of sustained wind, NASA gave the order to abort. Nobody wanted to stop a monthlong mission after only six days, but if the MAV took any more punishment, we’d all have gotten stranded down there.\" ,\n\n    \"We had to go out in the storm to get from the Hab to the MAV. That was going to be risky, but what choice did we have?\" ,\n\n    \"Everyone made it but me.\" ,\n\n    \"Our main communications dish, which relayed signals from the Hab to Hermes, acted like a parachute, getting torn from its foundation and carried with the torrent. Along the way, it crashed through the reception antenna array. Then one of those long thin antennae slammed into me end-first. It tore through my suit like a bullet through butter, and I felt the worst pain of my life as it ripped open my side. I vaguely remember having the wind knocked out of me (pulled out of me, really) and my ears popping painfully as the pressure of my suit escaped.\" ,\n\n    \"The last thing I remember was seeing Johanssen hopelessly reaching out toward me.\" ,\n\n    \"I awoke to the oxygen alarm in my suit. A steady, obnoxious beeping that eventually roused me from a deep and profound desire to just fucking die.\" ,\n\n    \"The storm had abated; I was facedown, almost totally buried in sand. As I groggily came to, I wondered why I wasn’t more dead.\" ,\n\n    \"The antenna had enough force to punch through the suit and my side, but it had been stopped by my pelvis. So there was only one hole in the suit (and a hole in me, of course).\" ,\n\n    \"I had been knocked back quite a ways and rolled down a steep hill. Somehow I landed facedown, which forced the antenna to a strongly oblique angle that put a lot of torque on the hole in the suit. It made a weak seal.\" ,\n\n    \"Then, the copious blood from my wound trickled down toward the hole. As the blood reached the site of the breach, the water in it quickly evaporated from the airflow and low pressure, leaving a gunky residue behind. More blood came in behind it and was also reduced to gunk. Eventually, it sealed the gaps around the hole and reduced the leak to something the suit could counteract.\" ,\n\n    \"The suit did its job admirably. Sensing the drop in pressure, it constantly flooded itself with air from my nitrogen tank to equalize. Once the leak became manageable, it only had to trickle new air in slowly to relieve the air lost.\" ,\n\n    \"After a while, the CO2 (carbon dioxide) absorbers in the suit were expended. That’s really the limiting factor to life support. Not the amount of oxygen you bring with you, but the amount of CO2 you can remove. In the Hab, I have the oxygenator, a large piece of equipment that breaks apart CO2 to give the oxygen back. But the space suits have to be portable, so they use a simple chemical absorption process with expendable filters. I’d been asleep long enough that my filters were useless.\" ,\n\n    \"The suit saw this problem and moved into an emergency mode the engineers call “bloodletting.” Having no way to separate out the CO2, the suit deliberately vented air to the Martian atmosphere, then backfilled with nitrogen. Between the breach and the bloodletting, it quickly ran out of nitrogen. All it had left was my oxygen tank.\" ,\n\n    \"So it did the only thing it could to keep me alive. It started backfilling with pure oxygen. I now risked dying from oxygen toxicity, as the excessively high amount of oxygen threatened to burn up my nervous system, lungs, and eyes. An ironic death for someone with a leaky space suit: too much oxygen.\" ,\n\n    \"Every step of the way would have had beeping alarms, alerts, and warnings. But it was the high-oxygen warning that woke me.\" ,\n\n    \"The sheer volume of training for a space mission is astounding. I’d spent a week back on Earth practicing emergency space suit drills. I knew what to do.\" ,\n\n    \"Carefully reaching to the side of my helmet, I got the breach kit. It’s nothing more than a funnel with a valve at the small end and an unbelievably sticky resin on the wide end. The idea is you have the valve open and stick the wide end over a hole. The air can escape through the valve, so it doesn’t interfere with the resin making a good seal. Then you close the valve, and you’ve sealed the breach.\" ,\n\n    \"The tricky part was getting the antenna out of the way. I pulled it out as fast as I could, wincing as the sudden pressure drop dizzied me and made the wound in my side scream in agony.\" ,\n\n    \"I got the breach kit over the hole and sealed it. It held. The suit backfilled the missing air with yet more oxygen. Checking my arm readouts, I saw the suit was now at 85 percent oxygen. For reference, Earth’s atmosphere is about 21 percent. I’d be okay, so long as I didn’t spend too much time like that.\" ,\n\n    \"I stumbled up the hill back toward the Hab. As I crested the rise, I saw something that made me very happy and something that made me very sad: The Hab was intact (yay!) and the MAV was gone (boo!).\" ,\n\n    \"Right that moment I knew I was screwed. But I didn’t want to just die out on the surface. I limped back to the Hab and fumbled my way into an airlock. As soon as it equalized, I threw off my helmet.\" ,\n\n    \"Once inside the Hab, I doffed the suit and got my first good look at the injury. It would need stitches. Fortunately, all of us had been trained in basic medical procedures, and the Hab had excellent medical supplies. A quick shot of local anesthetic, irrigate the wound, nine stitches, and I was done. I’d be taking antibiotics for a couple of weeks, but other than that I’d be fine.\" ,\n\n    \"I knew it was hopeless, but I tried firing up the communications array. No signal, of course. The primary satellite dish had broken off, remember? And it took the reception antennae with it. The Hab had secondary and tertiary communications systems, but they were both just for talking to the MAV, which would use its much more powerful systems to relay to Hermes. Thing is, that only works if the MAV is still around.\" ,\n\n    \"I had no way to talk to Hermes. In time, I could locate the dish out on the surface, but it would take weeks for me to rig up any repairs, and that would be too late. In an abort, Hermes would leave orbit within twenty-four hours. The orbital dynamics made the trip safer and shorter the earlier you left, so why wait?\" ,\n\n    \"Checking out my suit, I saw the antenna had plowed through my bio-monitor computer. When on an EVA, all the crew’s suits are networked so we can see each other’s status. The rest of the crew would have seen the pressure in my suit drop to nearly zero, followed immediately by my bio-signs going flat. Add to that watching me tumble down a hill with a spear through me in the middle of a sandstorm . . . yeah. They thought I was dead. How could they not?\" ,\n\n    \"They may have even had a brief discussion about recovering my body, but regulations are clear. In the event a crewman dies on Mars, he stays on Mars. Leaving his body behind reduces weight for the MAV on the trip back. That means more disposable fuel and a larger margin of error for the return thrust. No point in giving that up for sentimentality.\" ,\n\n    \"So that’s the situation. I’m stranded on Mars. I have no way to communicate with Hermes or Earth. Everyone thinks I’m dead. I’m in a Hab designed to last thirty-one days.\" ,\n\n    \"If the oxygenator breaks down, I’ll suffocate. If the water reclaimer breaks down, I’ll die of thirst. If the Hab breaches, I’ll just kind of explode. If none of those things happen, I’ll eventually run out of food and starve to death.\" ,\n\n    \"So yeah. I’m fucked.\" ,\n\n    \"Chapter 2\" ,\n\n    \"LOG ENTRY: SOL 7\" ,\n\n    \"Okay, I’ve had a good night’s sleep, and things don’t seem as hopeless as they did yesterday.\" ,\n\n    \"Today I took stock of supplies and did a quick EVA to check up on the external equipment. Here’s my situation:\" ,\n\n    \"The surface mission was supposed to be thirty-one days. For redundancy, the supply probes had enough food to last the whole crew fifty-six days. That way if one or two probes had problems, we’d still have enough food to complete the mission.\" ,\n\n    \"We were six days in when all hell broke loose, so that leaves enough food to feed six people for fifty days. I’m just one guy, so it’ll last me three hundred days. And that’s if I don’t ration it. So I’ve got a fair bit of time.\" ,\n\n    \"I’m pretty flush on EVA suits, too. Each crew member had two space suits: a flight spacesuit to wear during descent and ascent, and the much bulkier and more robust EVA suit to wear when doing surface operations. My flight spacesuit has a hole in it, and of course the crew was wearing the other five when they returned to Hermes. But all six EVA suits are still here and in perfect condition\"\n]","import React from 'react';\nimport * as tf from \"@tensorflow/tfjs\"\nimport './App.css';\nimport {priors} from './priors'\nimport Paper from '@material-ui/core/Paper';\nimport {MyButton} from \"./components/MyButton\";\nimport {SmallButton} from \"./components/SmallButton\";\nimport Scrollbar from \"react-scrollbars-custom\";\nimport {text} from \"./text\"\n\nimport 'chartjs-plugin-streaming'\n\nclass App extends React.Component {\n\n    constructor(props) {\n        super(props);\n\n        this.priorsTensor=undefined;\n        this.detectorModel=undefined;\n        this.landmarksModel=undefined;\n\n        this.cxhat=undefined;\n        this.cyhat=undefined;\n        this.what =undefined;\n        this.hhat =undefined;\n\n        this.confidence=undefined;\n\n        this.gcx=undefined;\n        this.gcy=undefined;\n        this.gw =undefined;\n        this.gh =undefined;\n\n        this.bboxes=undefined;\n\n        this.videoRef=React.createRef();\n\n        this.inputCanvasRef=React.createRef();\n        this.outputCanvasRef=React.createRef();\n        \n        this.leftCanvasRef=React.createRef();\n        this.rightCanvasRef=React.createRef();\n\n        this.inputCtx=undefined;\n        this.outputCtx=undefined;\n        this.leftCtx=undefined;\n        this.rightCtx=undefined;\n\n        this.leftTextRef=React.createRef();\n        this.rightTextRef=React.createRef();\n        this.fpsTextRef=React.createRef();\n        this.scrollRef=React.createRef();\n\n        this.videoHeight=undefined;\n        this.videoWidth=undefined;\n        this.videoOriginX=undefined;\n        this.videoOriginY=undefined;\n        this.cropDim=undefined;\n        this.destDim=224;\n        this.sf=1.0;\n\n        this.eyeDim=112;\n        this.landmarkCount=4;\n\n        this.detectThreshold=0.7;\n        this.blinkThreshold=0.3;\n        this.nmsSigma=0.025;\n\n        this.leftRatioHistory=[];\n        this.rightRatioHistory=[];\n\n        this.state={\n            scrollPos:50,\n            inProgress:false,\n        }\n    }\n\n    componentDidMount() {\n\n        this.priorsTensor=tf.tensor2d(priors);\n        const priorSplits=tf.split(this.priorsTensor,4,1);\n\n        this.cxhat=priorSplits[0]\n        this.cyhat=priorSplits[1]\n        this.what =priorSplits[2]\n        this.hhat =priorSplits[3]\n\n        tf.loadLayersModel(\"https://raw.githubusercontent.com/jhanmtl/eye-scroller/master/public/detectorModel.json\").then(loadedModel=>{\n                                this.detectorModel=loadedModel;\n                            });\n        tf.loadLayersModel(\"https://raw.githubusercontent.com/jhanmtl/eye-scroller/master/public/landmarkModel.json\").then(loadedModel=>{\n            this.landmarksModel=loadedModel;\n                            });\n\n        this.inputCtx=this.inputCanvasRef.current.getContext('2d');\n        this.outputCtx=this.outputCanvasRef.current.getContext('2d');\n        this.leftCtx=this.leftCanvasRef.current.getContext('2d');\n        this.rightCtx=this.rightCanvasRef.current.getContext('2d');\n\n        this.fillBlack();\n        console.log(tf.getBackend())\n    }\n\n    setCropProps=(stream)=>{\n        this.videoHeight=stream.getVideoTracks()[0].getSettings().height;\n        this.videoWidth =stream.getVideoTracks()[0].getSettings().width;\n\n        const cen_x=this.videoWidth/2\n        const cen_y=this.videoHeight/2\n\n        this.cropDim=this.destDim/this.sf\n        this.videoOriginX=cen_x-this.cropDim/2\n        this.videoOriginY=cen_y-this.cropDim/2\n    }\n\n    startWebcam=()=>{\n        this.setState(\n            {\n                inProgress:true\n            }\n        )\n        if (navigator.mediaDevices.getUserMedia){\n            navigator.mediaDevices.getUserMedia({\n                video:true,\n                audio:false,\n            }).then(stream=>{\n                this.videoRef.current.srcObject=stream;\n                this.videoRef.current.style.display='none'\n                this.inputCanvasRef.current.style.display='none'\n                this.setCropProps(stream)\n                this.synchroPredict();\n            })\n        }\n    }\n\n    cropToCanvas=()=>{\n        this.inputCtx.drawImage(this.videoRef.current,\n                                this.videoOriginX,\n                                this.videoOriginY,\n                                this.cropDim,\n                                this.cropDim,\n                                0,\n                                0,\n                                this.destDim,\n                                this.destDim)\n    }\n\n    parsePredictions=(predictions)=>{\n        let confidence=predictions[0]\n        this.confidence=confidence.reshape([36])\n\n        let offsets=predictions[1]\n        offsets=offsets.reshape([36,4])\n\n        const splits=tf.split(offsets,4,1)\n        this.gcx=splits[0]\n        this.gcy=splits[1]\n        this.gw =splits[2]\n        this.gh =splits[3]\n    }\n\n    recoverBboxes=()=>{\n        const cx=tf.add(tf.mul(this.gcx,this.what),this.cxhat)\n        const cy=tf.add(tf.mul(this.gcy,this.hhat),this.cyhat)\n        const w= tf.mul(tf.exp(this.gw),this.what)\n        const h= tf.mul(tf.exp(this.gh),this.hhat)\n\n        const x1=tf.cast(tf.mul(tf.sub(cx,tf.div(w,2)),224),'int32')\n        const y1=tf.cast(tf.mul(tf.sub(cy,tf.div(h,2)),224),'int32')\n        const x2=tf.cast(tf.mul(tf.add(cx,tf.div(w,2)),224),'int32')\n        const y2=tf.cast(tf.mul(tf.add(cy,tf.div(h,2)),224),'int32')\n\n        this.bboxes=tf.concat([y1,x1,y2,x2],1)\n    }\n\n    drawBox(box,style){\n        const x=box[1]\n        const y=box[0]\n        const w=box[3]-box[1]\n        const h=box[2]-box[0]\n\n        this.outputCtx.strokeStyle=style\n        this.outputCtx.lineWidth=1\n        this.outputCtx.strokeRect(x,y,w,h)\n    }\n\n    visualize(scoreA,scoreB,boxA,boxB){\n        this.drawBox(boxA, \"rgb(0,255,255)\")\n        this.drawBox(boxB, \"rgb(0,255,255)\")\n        this.leftTextRef.current.innerText=\"left eye confidence: \"+(100*scoreA).toFixed(2)+\"%\"\n        this.rightTextRef.current.innerText=\"right eye confidence: \"+(100*scoreB).toFixed(2)+\"%\"\n    }\n\n    updateOutputCanvas(){\n        this.outputCtx.drawImage(this.inputCanvasRef.current,\n                                0,\n                                0,\n                                this.destDim,\n                                this.destDim,\n                                0,\n                                0,\n                                this.destDim,\n                                this.destDim);\n    }\n\n    prepDetectorInput(canvas){\n        let imgTensor = tf.expandDims(tf.browser.fromPixels(canvas), 0);\n        imgTensor = tf.cast(imgTensor, 'float32');\n        imgTensor = tf.div(imgTensor, 127.5);\n        imgTensor = tf.sub(imgTensor, 1);\n\n        return imgTensor;\n    }\n\n    prepLandmarkInputSingle(canvas){\n        let imgTensor = tf.expandDims(tf.browser.fromPixels(canvas), 0);\n        imgTensor = tf.cast(imgTensor, 'float32');\n        imgTensor = tf.div(imgTensor, 127.5);\n        imgTensor = tf.sub(imgTensor, 1);\n\n        return imgTensor\n    }\n\n    getBoxesAndScores(predictions){\n        this.parsePredictions(predictions);\n        this.recoverBboxes();\n\n        let boxes = this.bboxes.arraySync()\n        let nmsResult = tf.image.nonMaxSuppressionWithScore(this.bboxes,\n                                                            this.confidence,\n                                                            2,\n                                                            undefined,\n                                                            undefined,\n                                                            this.nmsSigma);\n        let nmsIdx=nmsResult.selectedIndices;\n        nmsIdx=nmsIdx.dataSync();\n        let nmsScores=nmsResult.selectedScores;\n        nmsScores=nmsScores.dataSync();\n\n        let scoreA=nmsScores[0];\n        let scoreB=nmsScores[1];\n\n        let boxA;\n        let boxB;\n\n        if (boxes[nmsIdx[0]][1]<boxes[nmsIdx[1]][1]){\n            boxA=boxes[nmsIdx[1]];\n            boxB=boxes[nmsIdx[0]];\n        }\n        else{\n            boxA=boxes[nmsIdx[0]];\n            boxB=boxes[nmsIdx[1]];\n        }\n\n        return [scoreA,scoreB,boxA,boxB]\n    }\n\n    logFps(t0,t1){\n        const elapsed=(t1-t0)/1000.0\n        const fps=Math.round(1.0/elapsed)\n        this.fpsTextRef.current.innerText=\"fps: \"+fps\n    }\n\n    boxCrop=(box,ctx)=>{\n        const cenX=(box[1]+box[3])/2\n        const cenY=(box[0]+box[2])/2\n        const h=box[2]-box[0]\n        const w=box[3]-box[1]\n\n        let cropSize=Math.max(h,w);\n        cropSize+=10;\n\n        const originX=cenX-cropSize/2;\n        const originY=cenY-cropSize/2;\n\n        ctx.drawImage(this.inputCanvasRef.current,\n                    originX,\n                    originY,\n                    cropSize,\n                    cropSize,\n                    0,\n                    0,\n                    this.eyeDim,\n                    this.eyeDim);\n    }\n\n    predictLandmarks(inputCanvas){\n        const input=this.prepLandmarkInputSingle(inputCanvas);\n        let prediction=this.landmarksModel.predict(input);\n        prediction=tf.cast(prediction,'int32');\n        prediction=tf.reshape(prediction,[this.landmarkCount,2])\n        let landmarks=prediction.arraySync();\n        return landmarks;\n    }\n\n    fillBlack(){\n        const blackBg='rgb(0,0,0)';\n        this.leftCtx.fillStyle=blackBg;\n        this.rightCtx.fillStyle=blackBg;\n        this.leftCtx.fillRect(0,0,this.eyeDim,this.eyeDim);\n        this.rightCtx.fillRect(0,0,this.eyeDim,this.eyeDim);\n    }\n\n    drawLandmarks(landmarks,ctx,style){\n        ctx.fillStyle='rgb(0,0,0)'\n        ctx.fillRect(0,0,this.eyeDim,this.eyeDim)\n\n        for (let i=0;i<landmarks.length;i++){\n            ctx.beginPath();\n            const landmark=landmarks[i];\n            const x=landmark[0]\n            const y=landmark[1]\n            ctx.arc(x,y,2,0,2*Math.PI)\n            ctx.fillStyle=style\n            ctx.fill();\n        }\n\n        for (let i=0;i<landmarks.length;i++){\n\n            let startPt=landmarks[i];\n            let endPt;\n\n            if (i===landmarks.length-1){\n                endPt=landmarks[0];\n            }\n            else{\n                endPt=landmarks[i+1]\n            }\n\n            ctx.beginPath();\n            ctx.moveTo(startPt[0],startPt[1])\n            ctx.lineTo(endPt[0],endPt[1])\n            ctx.strokeStyle=style\n            ctx.stroke();\n        }\n\n        const topMarker=landmarks[1]\n        const bottomMarker=landmarks[3]\n        const centerX=(topMarker[0]+bottomMarker[0])/2\n        const centerY=(topMarker[1]+bottomMarker[1])/2\n        const height=Math.abs(bottomMarker[1]-topMarker[1])\n        const radius=height/2\n\n        const leftMarker=landmarks[0]\n        const rightMarker=landmarks[2]\n        const width=Math.abs(leftMarker[0]-rightMarker[0])\n\n        ctx.beginPath();\n        ctx.arc(centerX,centerY,radius,0,2*Math.PI);\n        ctx.strokeStyle=style;\n        ctx.stroke();\n\n        ctx.beginPath();\n        ctx.arc(centerX,centerY,radius/2,0,2*Math.PI);\n        ctx.fillStyle=style;\n        ctx.fill();\n\n        return height/(width+1e-3);\n    }\n\n    logRatioHistory=(nowLeftRatio, nowRightRatio)=>{\n        if (this.leftRatioHistory.length<2){\n            this.leftRatioHistory.push(nowLeftRatio);\n        }\n        else{\n            this.leftRatioHistory[0]=this.leftRatioHistory[1];\n            this.leftRatioHistory[1]=nowLeftRatio;\n        }\n\n        if (this.rightRatioHistory.length<2){\n            this.rightRatioHistory.push(nowRightRatio);\n        }\n        else{\n            this.rightRatioHistory[0]=this.rightRatioHistory[1];\n            this.rightRatioHistory[1]=nowRightRatio;\n        }\n    }\n\n    percentDiff=(ratioHistory)=>{\n        let top=ratioHistory[0]-ratioHistory[1]\n        let bottom=(ratioHistory[0]+1e-5)\n        return top/bottom\n    }\n\n    synchroPredict=()=> {\n        const t0 = performance.now()\n        tf.tidy(() => {\n                this.cropToCanvas();\n                this.updateOutputCanvas();\n\n                const detectorModelInput=this.prepDetectorInput(this.inputCanvasRef.current);\n                const predictions = this.detectorModel.predict(detectorModelInput);\n                const [scoreLeft,scoreRight,boxLeft,boxRight]=this.getBoxesAndScores(predictions);\n\n                if (scoreLeft > this.detectThreshold && scoreRight > this.detectThreshold) {\n\n                    this.visualize(scoreLeft,scoreRight,boxLeft,boxRight);\n\n                    this.boxCrop(boxLeft,this.leftCtx);\n                    this.boxCrop(boxRight,this.rightCtx);\n\n                    let leftLandmarks=this.predictLandmarks(this.leftCanvasRef.current)\n                    let currentLeftRatio=this.drawLandmarks(leftLandmarks,this.leftCtx,'rgb(0,255,255)');\n\n                    let rightLandmarks=this.predictLandmarks(this.rightCanvasRef.current)\n                    let currentRightRatio=this.drawLandmarks(rightLandmarks,this.rightCtx,'rgb(0,255,255)');\n\n                    this.logRatioHistory(currentLeftRatio,currentRightRatio);\n\n                    let leftChange=this.percentDiff(this.leftRatioHistory)\n                    let rightChange=this.percentDiff(this.rightRatioHistory)\n\n                    if (leftChange>this.blinkThreshold || rightChange>this.blinkThreshold){\n                        this.scrollDown();\n                    }\n                }\n\n                else{\n                    this.fillBlack();\n                }\n            })\n\n        const t1=performance.now()\n        this.logFps(t0,t1);\n        window.requestAnimationFrame(this.synchroPredict)\n    }\n\n\n    scrollDown=()=>{\n        this.scrollRef.current.scrollTo(0, this.state.scrollPos);\n        let newPos=Math.min(this.state.scrollPos+50, 4100)\n        if (newPos<4100) {\n            this.setState({\n                scrollPos: newPos\n            })\n        }\n        else{\n             this.scrollRef.current.scrollToTop();\n             this.setState({\n                scrollPos: 50\n            })\n        }\n    }\n\n    scrollToTop=()=>{\n       this.scrollRef.current.scrollToTop();\n       this.setState({\n           scrollPos:50\n       })\n    }\n\n    formatText(){\n        let paragraphs=[]\n        for (let i=0;i<text.length;i++){\n            if (i<5){\n                paragraphs.push(\n                    <p key={i} className=\"headerNotes\">{text[i]}</p>\n                )\n            }\n            else if (i===6){\n                paragraphs.push(\n                    <p key={i} className=\"smallNote\">{text[i]}</p>\n                )\n            }\n            else{\n                 paragraphs.push(\n                    <p key={i} className=\"note\">{text[i]}</p>\n                )\n            }\n\n        }\n        return paragraphs\n    }\n\n    render(){\n\n        return (\n            <div className=\"App\">\n                <div className=\"overall\">\n                    <div className=\"controlPanel\">\n                        <Paper className=\"controlPaper\" elevation={4}>\n                            <p className=\"title\">smart scroller: tensorflowjs + react</p>\n\n                            <p className=\"note\">eye detection</p>\n\n                            <div className=\"container\">\n                                <div className=\"videoUnderlay\">\n                                    <video id=\"webCam\" autoPlay ref={this.videoRef}/>\n                                </div>\n\n                                <div className=\"input\">\n                                    <canvas id='inputCanvasId' className=\"inputCanvas\" width={224} height={224} ref={this.inputCanvasRef}/>\n                                </div>\n\n                                <div className=\"output\">\n                                        <canvas className=\"outputCanvas\" width={224} height={224} ref={this.outputCanvasRef}/>\n                                </div>\n\n                                <div className=\"output\">\n                                    {(this.state.inProgress)?<p className=\"loadingText\">initiating model . . .</p>:\"\"}\n                                </div>\n\n                                    <p className=\"note\">eye extraction</p>\n\n                                <div>\n                                    <canvas className=\"leftEyeCanvas\" width={this.eyeDim} height={this.eyeDim} ref={this.leftCanvasRef}/>\n                                    <canvas className=\"rightEyeCanvas\" width={this.eyeDim} height={this.eyeDim} ref={this.rightCanvasRef}/>\n                                </div>\n\n                                <MyButton onClick={this.startWebcam}>start model</MyButton>\n\n                                <p className=\"note\" ref={this.leftTextRef}>left eye confidence:</p>\n                                <p className=\"note\" ref={this.rightTextRef}>right eye confidence:</p>\n                                <p className=\"note\" ref={this.fpsTextRef}>fps:</p>\n\n                                <a href=\"https://github.com/jhanmtl/eye-detector\" className=\"note\">github repo</a>\n\n                            </div>\n\n                        </Paper>\n                    </div>\n                    <div className=\"textWindow\">\n                        <Paper className=\"textPaper\" elevation={4}>\n                            <div className=\"textContent\">\n                                <Scrollbar ref={this.scrollRef} minimalThumbSize={10} maximalThumbSize={12}>\n                                    <div className=\"textBox\">\n                                        {this.formatText()}\n                                    </div>\n                                </Scrollbar>\n                            </div>\n\n                            <SmallButton onClick={this.scrollToTop} style={{}}>back to top</SmallButton>\n\n                        </Paper>\n\n                    </div>\n                </div>\n\n\n            </div>\n\n\n        );\n    }\n\n}\n\nexport default App;\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.0/8 are considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl, {\n    headers: { 'Service-Worker': 'script' },\n  })\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready\n      .then(registration => {\n        registration.unregister();\n      })\n      .catch(error => {\n        console.error(error.message);\n      });\n  }\n}\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './App';\nimport * as serviceWorker from './serviceWorker';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want your app to work offline and load faster, you can change\n// unregister() to register() below. Note this comes with some pitfalls.\n// Learn more about service workers: https://bit.ly/CRA-PWA\nserviceWorker.unregister();\n"],"sourceRoot":""}